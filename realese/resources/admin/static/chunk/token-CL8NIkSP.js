import{l as j}from"./global-Czwz-x68.js";import{s as D,T as l,_ as Y}from"../entry/index-Czm67r7X.js";import{aa as Z}from"./__vendor-BGruaAdM.js";import{c as V,b as L}from"./_element-plus-T6dmKOyC.js";import{x as A,l as $,aa as G,w as Q,r as H,an as s,at as J,c as B,o as b,e as a,Y as n,u as e,P as K,ah as W,b as R,a0 as h,a1 as m,Z as X,_ as ee,a as te}from"./_@vue-DEM3y_BF.js";import"./_axios-BtuGy7By.js";import"./_@element-plus-CvluYIrs.js";import"./_@popperjs-DB1lLFnh.js";function ae(d){return D({url:"/user_token/list",params:d})}function le(d){return D({url:"/user_token/delete",method:"post",data:d})}function ne(d){return D({url:"/user_token/batchDelete",method:"post",data:d})}function oe(){const g=Z().query?.user_id,p=A({list:[],total:0,loading:!1}),c=A({page:1,page_size:10,is_my:0,user_id:g?parseInt(g):null}),o=async()=>{p.loading=!0;const r=await ae(c).catch(v=>!1);p.loading=!1,r&&(p.list=r.data.list,p.total=r.data.total)};return{listRes:p,listQuery:c,getList:o,handlerQuery:()=>{c.page===1?o():c.page=1},del:async r=>{if(!await V.confirm(l("Confirm?",{param:l("Logout")}),{confirmButtonText:l("Confirm"),cancelButtonText:l("Cancel"),type:"warning"}).catch(_=>!1))return!1;await le({id:r.id}).catch(_=>!1)&&(L.success(l("OperationSuccess")),o())},batchDelete:async r=>{if(!await V.confirm(l("Confirm?",{param:l("BatchDelete")}),{confirmButtonText:l("Confirm"),cancelButtonText:l("Cancel"),type:"warning"}).catch(_=>!1))return!1;await ne({ids:r}).catch(_=>!1)&&(L.success(l("OperationSuccess")),o())}}}const se={key:0},re={__name:"token",setup(d){const{allUsers:g,getAllUsers:p}=j();p();const{listRes:c,listQuery:o,getList:y,handlerQuery:k,del:T,batchDelete:r}=oe();$(y),G(y),Q(()=>o.page,y),Q(()=>o.page_size,k);const v=i=>i.slice(0,4)+"****"+i.slice(-4),w=i=>{const u=new Date().getTime();return i.expired_at*1e3<u},_=H([]),E=i=>{_.value=i},N=()=>{_.value.length!==0&&r(_.value.map(i=>i.id))};return(i,u)=>{const M=s("el-option"),O=s("el-select"),z=s("el-form-item"),x=s("el-button"),q=s("el-form"),C=s("el-card"),f=s("el-table-column"),S=s("el-tag"),F=s("el-table"),I=s("el-pagination"),P=J("loading");return b(),B("div",null,[a(C,{class:"list-query",shadow:"hover"},{default:n(()=>[a(q,{inline:"","label-width":"80px"},{default:n(()=>[a(z,{label:e(l)("User")},{default:n(()=>[a(O,{modelValue:e(o).user_id,"onUpdate:modelValue":u[0]||(u[0]=t=>e(o).user_id=t),clearable:""},{default:n(()=>[(b(!0),B(K,null,W(e(g),t=>(b(),R(M,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(z,null,{default:n(()=>[a(x,{type:"primary",onClick:e(k)},{default:n(()=>[h(m(e(l)("Filter")),1)]),_:1},8,["onClick"]),a(x,{type:"danger",onClick:N},{default:n(()=>[h(m(e(l)("BatchDelete")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(C,{class:"list-body",shadow:"hover"},{default:n(()=>[X((b(),R(F,{data:e(c).list,border:"",onSelectionChange:E},{default:n(()=>[a(f,{type:"selection",align:"center",width:"50"}),a(f,{prop:"id",label:"id",align:"center",width:"100"}),a(f,{label:e(l)("Owner"),align:"center"},{default:n(({row:t})=>[t.user_id?(b(),B("span",se,[a(S,null,{default:n(()=>[h(m(e(g)?.find(U=>U.id===t.user_id)?.username),1)]),_:2},1024)])):ee("",!0)]),_:1},8,["label"]),a(f,{label:e(l)("Token"),align:"center"},{default:n(({row:t})=>[te("span",null,m(v(t.token)),1)]),_:1},8,["label"]),a(f,{prop:"created_at",label:e(l)("CreatedAt"),align:"center"},null,8,["label"]),a(f,{label:e(l)("ExpireTime"),prop:"expired_at",align:"center"},{default:n(({row:t})=>[a(S,{type:w(t)?"info":"success"},{default:n(()=>[h(m(t.expired_at?new Date(t.expired_at*1e3).toLocaleString():"-"),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(f,{label:e(l)("Actions"),align:"center",width:"400"},{default:n(({row:t})=>[a(x,{type:"danger",onClick:U=>e(T)(t)},{default:n(()=>[h(m(e(l)("Logout")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[P,e(c).loading]])]),_:1}),a(C,{class:"list-page",shadow:"hover"},{default:n(()=>[a(I,{background:"",layout:"prev, pager, next, sizes, jumper","page-sizes":[10,20,50,100],"page-size":e(o).page_size,"onUpdate:pageSize":u[1]||(u[1]=t=>e(o).page_size=t),"current-page":e(o).page,"onUpdate:currentPage":u[2]||(u[2]=t=>e(o).page=t),total:e(c).total},null,8,["page-size","current-page","total"])]),_:1})])}}},ge=Y(re,[["__scopeId","data-v-efab04a0"]]);export{ge as default};
