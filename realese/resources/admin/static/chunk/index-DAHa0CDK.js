import{x as V,l as X,aa as ee,w as q,r as A,an as d,at as le,c as z,o as v,e as l,Y as r,a0 as m,a1 as _,u as n,Z as D,b as y,_ as C,P as te,ah as ae,a2 as oe,a as E}from"./_@vue-DEM3y_BF.js";import{l as re,r as ne,d as ie,e as se}from"./oauth-BZ1Fh4vz.js";import{d as de,T as t}from"../entry/index-Czm67r7X.js";import{h as ue}from"./clipboard-CMGTTqw4.js";import{T as pe}from"./_@element-plus-CvluYIrs.js";import{c as ce,b as I}from"./_element-plus-T6dmKOyC.js";import"./__vendor-BGruaAdM.js";import"./_axios-BtuGy7By.js";import"./_@popperjs-DB1lLFnh.js";const _e={style:{display:"block","margin-left":"10px"}},we={__name:"index",setup(me){const B=de(),T=i=>{ue(P(),i)},f=V({list:[],total:0,loading:!1}),p=V({page:1,page_size:10}),M=[{value:"github",label:"GitHub"},{value:"google",label:"Google"},{value:"linuxdo",label:"LinuxDo"},{value:"oidc",label:"OIDC"}],g=async()=>{f.loading=!0;const i=await re(p).catch(a=>!1);f.loading=!1,i&&(f.list=i.data.list,f.total=i.data.total)},w=()=>{p.page===1?g():p.page=1},N=async i=>{if(!await ce.confirm(t("Confirm?",{param:t("Delete")}),{confirmButtonText:t("Confirm"),cancelButtonText:t("Cancel"),type:"warning"}).catch(s=>!1))return!1;await ne({id:i.id}).catch(s=>!1)&&(I.success(t("OperationSuccess")),g())};X(g),ee(g),q(()=>p.page,g),q(()=>p.page_size,w);const b=A(!1),e=V({id:0,op:"",oauth_type:"",issuer:"",client_id:"",client_secret:"",redirect_url:"",scopes:"",auto_register:!1,pkce_enable:!1,pkce_method:"S256"}),$={client_id:[{required:!0,message:t("ParamRequired",{param:"client_id"}),trigger:"blur"}],client_secret:[{required:!0,message:t("ParamRequired",{param:"client_secret"}),trigger:"blur"}],oauth_type:[{required:!0,message:t("ParamRequired",{param:"oauth_type"}),trigger:"blur"}],issuer:[{required:!0,message:t("ParamRequired",{param:"issuer"}),trigger:"blur"}],pkce_method:[{required:!1,message:t("ParamRequired",{param:"pkce_method"}),trigger:"blur"},{validator:(i,a,u)=>{["S256","plain"].includes(a)?u():u(new Error(t("InvalidParam",{param:"pkce_method"})))},trigger:"change"}]},P=()=>`${B.setting.rustdeskConfig.api_server||window.location.origin}/api/oidc/callback`,O=i=>{b.value=!0,e.id=i.id,e.op=i.op,e.oauth_type=i.oauth_type,e.issuer=i.issuer,e.client_id=i.client_id,e.client_secret=i.client_secret,e.scopes=i.scopes,e.auto_register=i.auto_register,e.pkce_enable=i.pkce_enable,e.pkce_method=i.pkce_method},L=()=>{b.value=!0,e.id=0,e.op="",e.oauth_type="",e.issuer="",e.client_id="",e.client_secret="",e.scopes="",e.auto_register=!1,e.pkce_enable=!1,e.pkce_method="S256"},x=A(null),F=async()=>{if(!await x.value.validate().catch(s=>!1))return;await(e.id?ie:se)(e).catch(s=>!1)&&(I.success(t("OperationSuccess")),b.value=!1,g())};return(i,a)=>{const u=d("el-button"),s=d("el-form-item"),U=d("el-form"),h=d("el-card"),c=d("el-table-column"),G=d("el-table"),Q=d("el-pagination"),Y=d("el-radio"),j=d("el-radio-group"),k=d("el-input"),H=d("el-icon"),S=d("el-switch"),R=d("el-option"),K=d("el-select"),Z=d("el-dialog"),J=le("loading");return v(),z("div",null,[l(h,{class:"list-query",shadow:"hover"},{default:r(()=>[l(U,{inline:"","label-width":"80px"},{default:r(()=>[l(s,null,{default:r(()=>[l(u,{type:"primary",onClick:w},{default:r(()=>[m(_(n(t)("Filter")),1)]),_:1}),l(u,{type:"danger",onClick:L},{default:r(()=>[m(_(n(t)("Add")),1)]),_:1})]),_:1})]),_:1})]),_:1}),l(h,{class:"list-body",shadow:"hover"},{default:r(()=>[D((v(),y(G,{data:f.list,border:""},{default:r(()=>[l(c,{prop:"id",label:"ID",align:"center"}),l(c,{prop:"op",label:n(t)("IdP"),align:"center"},null,8,["label"]),l(c,{prop:"oauth_type",label:n(t)("Type"),align:"center"},null,8,["label"]),l(c,{prop:"auto_register",label:n(t)("AutoRegister"),align:"center"},null,8,["label"]),l(c,{prop:"pkce_enable",label:n(t)("PkceEnable"),align:"center"},null,8,["label"]),l(c,{prop:"pkce_method",label:n(t)("PkceMethod"),align:"center"},null,8,["label"]),l(c,{prop:"created_at",label:n(t)("CreatedAt"),align:"center"},null,8,["label"]),l(c,{prop:"updated_at",label:n(t)("UpdatedAt"),align:"center"},null,8,["label"]),l(c,{label:n(t)("Actions"),align:"center"},{default:r(({row:o})=>[l(u,{onClick:W=>O(o)},{default:r(()=>[m(_(n(t)("Edit")),1)]),_:2},1032,["onClick"]),l(u,{type:"danger",onClick:W=>N(o)},{default:r(()=>[m(_(n(t)("Delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[J,f.loading]])]),_:1}),l(h,{class:"list-page",shadow:"hover"},{default:r(()=>[l(Q,{background:"",layout:"prev, pager, next, sizes, jumper","page-sizes":[10,20,50,100],"page-size":p.page_size,"onUpdate:pageSize":a[0]||(a[0]=o=>p.page_size=o),"current-page":p.page,"onUpdate:currentPage":a[1]||(a[1]=o=>p.page=o),total:f.total},null,8,["page-size","current-page","total"])]),_:1}),l(Z,{modelValue:b.value,"onUpdate:modelValue":a[12]||(a[12]=o=>b.value=o),title:e.id?n(t)("Update"):n(t)("Create"),width:"800"},{default:r(()=>[l(U,{class:"dialog-form",ref_key:"form",ref:x,model:e,rules:$,"label-width":"120px"},{default:r(()=>[l(s,{label:"Type",prop:"oauth_type"},{default:r(()=>[l(j,{modelValue:e.oauth_type,"onUpdate:modelValue":a[2]||(a[2]=o=>e.oauth_type=o),disabled:!!e.id},{default:r(()=>[(v(),z(te,null,ae(M,o=>l(Y,{key:o.value,value:o.value,style:{display:"block"}},{default:r(()=>[m(_(o.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1}),e.oauth_type==="oidc"?(v(),y(s,{key:0,label:"IdP",prop:"op"},{default:r(()=>[l(k,{modelValue:e.op,"onUpdate:modelValue":a[3]||(a[3]=o=>e.op=o),placeholder:n(t)("Your IdP Name")},null,8,["modelValue","placeholder"])]),_:1})):C("",!0),e.oauth_type==="oidc"?(v(),y(s,{key:1,label:"Issuer",prop:"issuer"},{default:r(()=>[l(k,{modelValue:e.issuer,"onUpdate:modelValue":a[4]||(a[4]=o=>e.issuer=o),placeholder:`${n(t)("Check your IdP docs, without")} '/.well-known/openid-configuration'`},null,8,["modelValue","placeholder"])]),_:1})):C("",!0),D(l(s,{label:"Scopes",prop:"scopes"},{default:r(()=>[l(k,{modelValue:e.scopes,"onUpdate:modelValue":a[5]||(a[5]=o=>e.scopes=o),placeholder:`${n(t)("Optional, default is")} 'openid,profile,email'`},null,8,["modelValue","placeholder"])]),_:1},512),[[oe,e.oauth_type==="oidc"]]),l(s,{label:"ClientId",prop:"client_id"},{default:r(()=>[l(k,{modelValue:e.client_id,"onUpdate:modelValue":a[6]||(a[6]=o=>e.client_id=o)},null,8,["modelValue"])]),_:1}),l(s,{label:"ClientSecret",prop:"client_secret"},{default:r(()=>[l(k,{modelValue:e.client_secret,"onUpdate:modelValue":a[7]||(a[7]=o=>e.client_secret=o),type:e.id?"password":"text","show-password":!e.id},null,8,["modelValue","type","show-password"])]),_:1}),l(s,{label:"RedirectUrl",prop:"redirect_url"},{default:r(()=>[E("div",{onClick:T},[m(_(P())+" ",1),l(H,null,{default:r(()=>[l(n(pe))]),_:1})])]),_:1}),l(s,{label:"PkceEnable",prop:"pkce_enable"},{default:r(()=>[l(S,{modelValue:e.pkce_enable,"onUpdate:modelValue":a[8]||(a[8]=o=>e.pkce_enable=o),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),e.pkce_enable?(v(),y(s,{key:2,label:"PkceMethod",prop:"pkce_method"},{default:r(()=>[l(K,{modelValue:e.pkce_method,"onUpdate:modelValue":a[9]||(a[9]=o=>e.pkce_method=o),placeholder:"Select PKCE Method"},{default:r(()=>[l(R,{label:"S256 (Recommended)",value:"S256"}),l(R,{label:"Plain",value:"plain"})]),_:1},8,["modelValue"])]),_:1})):C("",!0),l(s,{label:n(t)("AutoRegister"),prop:"auto_register"},{default:r(()=>[l(S,{modelValue:e.auto_register,"onUpdate:modelValue":a[10]||(a[10]=o=>e.auto_register=o),"active-value":!0,"inactive-value":!1},null,8,["modelValue"]),E("div",_e,_(n(t)("AutoRegisterNote")),1)]),_:1},8,["label"]),l(s,null,{default:r(()=>[l(u,{onClick:a[11]||(a[11]=o=>b.value=!1)},{default:r(()=>[m(_(n(t)("Cancel")),1)]),_:1}),l(u,{onClick:F,type:"primary"},{default:r(()=>[m(_(n(t)("Submit")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{we as default};
