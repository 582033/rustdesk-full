import{s as be,g as fe,u as _e,a as ge,c as ve,t as Ve}from"./peer-HGjDncml.js";import{T as o,_ as ke,d as he}from"../entry/index-Czm67r7X.js";import"./__vendor-BGruaAdM.js";import{h as X}from"./clipboard-CMGTTqw4.js";import{T as ee}from"./_@element-plus-CvluYIrs.js";import{x as le,w as J,r as H,m as ye,an as r,b as f,o as s,Y as t,e as l,_ as I,u as e,a0 as m,a1 as u,c as C,P as A,ah as D,l as q,aa as Ce,at as we,Z as Ue,a as xe,A as O}from"./_@vue-DEM3y_BF.js";import{P as Be}from"./platform-BWoAImIS.js";import"./collection-CALyNR1w.js";import"./_element-plus-T6dmKOyC.js";import"./_@popperjs-DB1lLFnh.js";import"./index-B1Bs_yz0.js";import"./peer-DzPg3Mq6.js";import"./_axios-BtuGy7By.js";const Te={__name:"shareByWebClient",props:{id:String,hash:String},emits:["cancel","success"],setup(K,{emit:R}){const h=K,p=R,d=le({id:h.id,password_type:"once",password:"",expire:1800,hash:h.hash});J(()=>h.id,()=>{E()});const E=()=>{console.log("init"),d.id=h.id,d.hash=h.hash,d.password="",d.expire=1800,d.password_type="once",g.value=""},g=H(""),P=ye(()=>[{label:o("Minutes",{param:5},5),value:300},{label:o("Minutes",{param:30},30),value:1800},{label:o("Hours",{param:1},1),value:3600},{label:o("Days",{param:1},1),value:86400},{label:o("Weeks",{param:1},1),value:604800},{label:o("Months",{param:1},1),value:2592e3},{label:o("Forever"),value:0}]),$=()=>{y.value=!1,p("cancel"),E()},y=H(!1),z=async()=>{if(!d.password)return;y.value=!0;const T={...d},v=await be(T).catch(w=>!1);v&&(g.value=fe(v.data.share_token),p("success")),y.value=!1},i=T=>{X(g.value,T)};return(T,v)=>{const w=r("el-form-item"),W=r("el-input"),Q=r("el-option"),j=r("el-select"),S=r("el-button"),L=r("el-form");return s(),f(L,{ref:"shareform",model:d,"label-width":"120px","label-suffix":" :"},{default:t(()=>[l(w,{label:e(o)("ID"),prop:"id",required:""},{default:t(()=>[m(u(d.id),1)]),_:1},8,["label"]),l(w,{label:e(o)("Password"),prop:"password",required:""},{default:t(()=>[l(W,{modelValue:d.password,"onUpdate:modelValue":v[0]||(v[0]=b=>d.password=b),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),l(w,{label:e(o)("ExpireTime"),prop:"expire",required:""},{default:t(()=>[l(j,{modelValue:d.expire,"onUpdate:modelValue":v[1]||(v[1]=b=>d.expire=b)},{default:t(()=>[(s(!0),C(A,null,D(P.value,b=>(s(),f(Q,{key:b.value,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),g.value?(s(),f(w,{key:0,label:e(o)("Link")},{default:t(()=>[l(W,{modelValue:g.value,"onUpdate:modelValue":v[2]||(v[2]=b=>g.value=b),readonly:""},{append:t(()=>[l(S,{icon:e(ee),onClick:i},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):I("",!0),l(w,null,{default:t(()=>[g.value?I("",!0):(s(),f(S,{key:0,onClick:$},{default:t(()=>[m(u(e(o)("Cancel")),1)]),_:1})),g.value?(s(),f(S,{key:2,onClick:$,type:"success"},{default:t(()=>[m(u(e(o)("Close")),1)]),_:1})):(s(),f(S,{key:1,loading:y.value,onClick:z,type:"primary"},{default:t(()=>[m(u(e(o)("Submit")),1)]),_:1},8,["loading"]))]),_:1})]),_:1},8,["model"])}}},Se={key:0},Le={key:1},Ae={__name:"index",setup(K){const R=he(),{listRes:h,listQuery:p,getList:d,handlerQuery:E,collectionListRes:g,getCollectionList:P,del:$,formVisible:y,platformList:z,formData:i,toEdit:T,toAdd:v,submit:w,tagListRes:W,changeCollectionForUpdate:Q,getCollectionListForUpdate:j,collectionListResForUpdate:S}=_e("my");q(P),q(j),q(d),Ce(d),J(()=>p.page,d),J(()=>p.page_size,E);const L=H(!1),b=le({id:"",hash:""}),ae=x=>{b.id=x.id,b.hash=x.hash,L.value=!0},{tagListRes:te,getTagList:oe,visible:M,show:ne,formData:N,submit:se}=ge();q(oe);const ie=async()=>{await se().catch(n=>!1)&&d()},de=H([]),ue=x=>{de.value=x,N.value.row_ids=x.map(n=>n.row_id)};return(x,n)=>{const B=r("el-option"),F=r("el-select"),c=r("el-form-item"),U=r("el-input"),_=r("el-button"),Y=r("el-form"),Z=r("el-card"),V=r("el-table-column"),re=r("el-icon"),pe=r("el-table"),me=r("el-pagination"),G=r("el-dialog"),ce=we("loading");return s(),C("div",null,[l(Z,{class:"list-query",shadow:"hover"},{default:t(()=>[l(Y,{inline:"","label-width":"120px"},{default:t(()=>[l(c,{label:e(o)("AddressBookName")},{default:t(()=>[l(F,{modelValue:e(p).collection_id,"onUpdate:modelValue":n[0]||(n[0]=a=>e(p).collection_id=a),clearable:""},{default:t(()=>[l(B,{value:0,label:e(o)("MyAddressBook")},null,8,["label"]),(s(!0),C(A,null,D(e(g).list,a=>(s(),f(B,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Id")},{default:t(()=>[l(U,{modelValue:e(p).id,"onUpdate:modelValue":n[1]||(n[1]=a=>e(p).id=a),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Username")},{default:t(()=>[l(U,{modelValue:e(p).username,"onUpdate:modelValue":n[2]||(n[2]=a=>e(p).username=a),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Hostname")},{default:t(()=>[l(U,{modelValue:e(p).hostname,"onUpdate:modelValue":n[3]||(n[3]=a=>e(p).hostname=a),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(c,null,{default:t(()=>[l(_,{type:"primary",onClick:e(E)},{default:t(()=>[m(u(e(o)("Filter")),1)]),_:1},8,["onClick"]),l(_,{type:"danger",onClick:e(v)},{default:t(()=>[m(u(e(o)("Add")),1)]),_:1},8,["onClick"]),l(_,{type:"primary",onClick:e(ne)},{default:t(()=>[m(u(e(o)("BatchEditTags")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),l(Z,{class:"list-body",shadow:"hover"},{default:t(()=>[Ue((s(),f(pe,{data:e(h).list,border:"",onSelectionChange:ue},{default:t(()=>[l(V,{type:"selection",width:"50",align:"center"}),l(V,{prop:"id",label:"ID",align:"center",width:"200"},{default:t(({row:a})=>[xe("div",null,[l(Be,{name:e(z).find(k=>k.label===a.platform)?.icon,style:{width:"20px",height:"20px",display:"inline-block"},color:"var(--basicBlack)"},null,8,["name"]),m(" "+u(a.id)+" ",1),l(re,{onClick:k=>e(X)(a.id,k)},{default:t(()=>[l(e(ee))]),_:2},1032,["onClick"])])]),_:1}),l(V,{prop:"collection_id",label:e(o)("AddressBookName"),align:"center",width:"150"},{default:t(({row:a})=>[a.collection_id===0?(s(),C("span",Se,u(e(o)("MyAddressBook")),1)):(s(),C("span",Le,u(e(g).list.find(k=>k.id===a.collection_id)?.name),1))]),_:1},8,["label"]),l(V,{prop:"username",label:e(o)("Username"),align:"center",width:"150"},null,8,["label"]),l(V,{prop:"hostname",label:e(o)("Hostname"),align:"center",width:"150"},null,8,["label"]),l(V,{prop:"tags",label:e(o)("Tags"),align:"center"},null,8,["label"]),l(V,{prop:"alias",label:e(o)("Alias"),align:"center",width:"150"},null,8,["label"]),l(V,{prop:"peer.version",label:e(o)("Version"),align:"center",width:"100"},null,8,["label"]),l(V,{prop:"hash",label:e(o)("Hash"),align:"center",width:"150","show-overflow-tooltip":""},null,8,["label"]),l(V,{label:e(o)("Actions"),align:"center","class-name":"table-actions",width:"600",fixed:"right"},{default:t(({row:a})=>[l(_,{type:"success",onClick:k=>e(ve)(a.id)},{default:t(()=>[m(u(e(o)("Link")),1)]),_:2},1032,["onClick"]),e(R).setting.appConfig.web_client?(s(),f(_,{key:0,type:"success",onClick:k=>e(Ve)(a)},{default:t(()=>n[22]||(n[22]=[m("Web Client")])),_:2},1032,["onClick"])):I("",!0),e(R).setting.appConfig.web_client?(s(),f(_,{key:1,type:"primary",onClick:k=>ae(a)},{default:t(()=>[m(u(e(o)("ShareByWebClient")),1)]),_:2},1032,["onClick"])):I("",!0),l(_,{onClick:k=>e(T)(a)},{default:t(()=>[m(u(e(o)("Edit")),1)]),_:2},1032,["onClick"]),l(_,{type:"danger",onClick:k=>e($)(a)},{default:t(()=>[m(u(e(o)("Delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[ce,e(h).loading]])]),_:1}),l(Z,{class:"list-page",shadow:"hover"},{default:t(()=>[l(me,{background:"",layout:"prev, pager, next, sizes, jumper","page-sizes":[10,20,50,100],"page-size":e(p).page_size,"onUpdate:pageSize":n[4]||(n[4]=a=>e(p).page_size=a),"current-page":e(p).page,"onUpdate:currentPage":n[5]||(n[5]=a=>e(p).page=a),total:e(h).total},null,8,["page-size","current-page","total"])]),_:1}),l(G,{modelValue:e(y),"onUpdate:modelValue":n[15]||(n[15]=a=>O(y)?y.value=a:null),width:"800",title:e(i).row_id?e(o)("Update"):e(o)("Create")},{default:t(()=>[l(Y,{class:"dialog-form",ref:"form",model:e(i),"label-width":"120px"},{default:t(()=>[l(c,{label:e(o)("AddressBookName"),required:"",prop:"collection_id"},{default:t(()=>[l(F,{modelValue:e(i).collection_id,"onUpdate:modelValue":n[6]||(n[6]=a=>e(i).collection_id=a),clearable:"",onChange:e(Q)},{default:t(()=>[l(B,{value:0,label:e(o)("MyAddressBook")},null,8,["label"]),(s(!0),C(A,null,D(e(S).list,a=>(s(),f(B,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1},8,["label"]),l(c,{label:"ID",prop:"id",required:""},{default:t(()=>[l(U,{modelValue:e(i).id,"onUpdate:modelValue":n[7]||(n[7]=a=>e(i).id=a)},null,8,["modelValue"])]),_:1}),l(c,{label:e(o)("Username"),prop:"username"},{default:t(()=>[l(U,{modelValue:e(i).username,"onUpdate:modelValue":n[8]||(n[8]=a=>e(i).username=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Alias"),prop:"alias"},{default:t(()=>[l(U,{modelValue:e(i).alias,"onUpdate:modelValue":n[9]||(n[9]=a=>e(i).alias=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Hash"),prop:"hash"},{default:t(()=>[l(U,{modelValue:e(i).hash,"onUpdate:modelValue":n[10]||(n[10]=a=>e(i).hash=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Hostname"),prop:"hostname"},{default:t(()=>[l(U,{modelValue:e(i).hostname,"onUpdate:modelValue":n[11]||(n[11]=a=>e(i).hostname=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Platform"),prop:"platform"},{default:t(()=>[l(F,{modelValue:e(i).platform,"onUpdate:modelValue":n[12]||(n[12]=a=>e(i).platform=a)},{default:t(()=>[(s(!0),C(A,null,D(e(z),a=>(s(),f(B,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e(o)("Tags"),prop:"tags"},{default:t(()=>[l(F,{modelValue:e(i).tags,"onUpdate:modelValue":n[13]||(n[13]=a=>e(i).tags=a),multiple:""},{default:t(()=>[(s(!0),C(A,null,D(e(W).list,a=>(s(),f(B,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(c,null,{default:t(()=>[l(_,{onClick:n[14]||(n[14]=a=>y.value=!1)},{default:t(()=>[m(u(e(o)("Cancel")),1)]),_:1}),l(_,{onClick:e(w),type:"primary"},{default:t(()=>[m(u(e(o)("Submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(G,{modelValue:L.value,"onUpdate:modelValue":n[18]||(n[18]=a=>L.value=a),width:"900","close-on-click-modal":!1},{default:t(()=>[l(Te,{id:b.id,hash:b.hash,onCancel:n[16]||(n[16]=a=>L.value=!1),onSuccess:n[17]||(n[17]=()=>{})},null,8,["id","hash"])]),_:1},8,["modelValue"]),l(G,{modelValue:e(M),"onUpdate:modelValue":n[21]||(n[21]=a=>O(M)?M.value=a:null),width:"800"},{default:t(()=>[l(Y,{model:e(N),"label-width":"120px",class:"dialog-form"},{default:t(()=>[l(c,{label:e(o)("Tags"),prop:"tags"},{default:t(()=>[l(F,{modelValue:e(N).tags,"onUpdate:modelValue":n[19]||(n[19]=a=>e(N).tags=a),multiple:""},{default:t(()=>[(s(!0),C(A,null,D(e(te).list,a=>(s(),f(B,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(c,null,{default:t(()=>[l(_,{onClick:n[20]||(n[20]=a=>M.value=!1)},{default:t(()=>[m(u(e(o)("Cancel")),1)]),_:1}),l(_,{onClick:ie,type:"primary"},{default:t(()=>[m(u(e(o)("Submit")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Qe=ke(Ae,[["__scopeId","data-v-81d3f895"]]);export{Qe as default};
