import{s as n,T as i}from"../entry/index-Czm67r7X.js";import{aa as D}from"./__vendor-BGruaAdM.js";import{u as L}from"./collection-CALyNR1w.js";import{b as y,c as O}from"./_element-plus-T6dmKOyC.js";import{x as b,r as $}from"./_@vue-DEM3y_BF.js";function q(t){return n({url:"/tag/list",params:t})}function A(t){return n({url:"/tag/create",method:"post",data:t})}function V(t){return n({url:"/tag/update",method:"post",data:t})}function j(t){return n({url:"/tag/delete",method:"post",data:t})}function k(t){return n({url:"/my/tag/list",params:t})}function w(t){return n({url:"/my/tag/create",method:"post",data:t})}function G(t){return n({url:"/my/tag/update",method:"post",data:t})}function H(t){return n({url:"/my/tag/delete",method:"post",data:t})}const m={admin:{list:q,remove:j,update:V,create:A},my:{list:k,remove:H,create:w,update:G}};function Z(t="my"){const v=D().query?.user_id,u=b({list:[],total:0,loading:!1}),d=b({page:1,page_size:10,user_id:v?parseInt(v):null,collection_id:null}),R=e=>{let o=e.toString(16);console.log("hex",o),o.length<8&&(o="0".repeat(8-o.length)+o);let l=o.slice(0,2),r=o.slice(2);return`rgba(${parseInt(r.slice(0,2),16)}, ${parseInt(r.slice(2,4),16)}, ${parseInt(r.slice(4,6),16)}, ${parseInt(l,16)/255})`},U=e=>{console.log("color",e);let o=e.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d+(\.\d+)?)\)/);console.log("rgba",o);let l=Math.round(parseFloat(o[4])*255).toString(16),r=parseInt(o[1]).toString(16),a=parseInt(o[2]).toString(16),c=parseInt(o[3]).toString(16);return l.length===1&&(l="0"+l),r.length===1&&(r="0"+r),a.length===1&&(a="0"+a),c.length===1&&(c="0"+c),console.log("to f color",l+r+a+c,parseInt(l+r+a+c,16)),parseInt(l+r+a+c,16)},g=async()=>{u.loading=!0;const e=await m[t].list(d).catch(o=>!1);u.loading=!1,e&&(u.list=e.data.list.map(o=>(o.color=R(o.color),o)),u.total=e.data.total)},x=()=>{d.page===1?g():d.page=1},S=async e=>{if(!await O.confirm(i("Confirm?",{param:i("Delete")}),{confirmButtonText:i("Confirm"),cancelButtonText:i("Cancel"),type:"warning"}).catch(r=>!1))return!1;await m[t].remove({id:e.id}).catch(r=>!1)&&(y.success(i("OperationSuccess")),g())},f=$(!1),s=b({id:0,name:"",color:0,user_id:null,collection_id:null}),I=$(""),F=e=>{I.value=e},Q=e=>{console.log("row",e),f.value=!0,s.id=e.id,s.name=e.name,s.color=e.color,s.user_id=e.user_id,s.collection_id=e.collection_id,p.user_id=e.user_id,_()},z=()=>{f.value=!0,s.id=0,s.name="",s.color="",s.user_id=null,s.collection_id=null},B=async()=>{if(console.log(s),!s.color){y.error("请选择颜色");return}const e=s.id?m[t].update:m[t].create,o={...s,color:U(s.color)};console.log(o),await e(o).catch(r=>!1)&&(y.success(i("OperationSuccess")),f.value=!1,g())},{listRes:h,listQuery:p,getList:_}=L(t);p.page_size=9999;const E=async e=>{s.collection_id=0,e?(p.user_id=e,_()):h.list=[]},{listRes:M,listQuery:T,getList:C}=L(t);return T.page_size=9999,{listRes:u,listQuery:d,getList:g,handlerQuery:x,del:S,formVisible:f,formData:s,toEdit:Q,toAdd:z,submit:B,activeChange:F,currentColor:I,collectionListRes:h,changeUser:E,getCollectionList:_,collectionListResForUpdate:M,changeUserForUpdate:async e=>{d.collection_id=null,e?(p.user_id=e,C()):h.list=[]},getCollectionListForUpdate:C}}export{Z as u};
