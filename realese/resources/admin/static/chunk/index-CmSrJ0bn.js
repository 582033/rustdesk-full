import{h as S,T as t,i as F,j as Y,k as Z}from"../entry/index-Czm67r7X.js";import{l as H}from"./group-DeA26ZkG.js";import{ab as J}from"./__vendor-BGruaAdM.js";import{j as K,d as W}from"./file-Dmzv2BFm.js";import{c as A,b as v}from"./_element-plus-T6dmKOyC.js";import{x as U,l as z,w as P,an as m,at as X,c as E,o as T,e as a,Y as n,u as e,a0 as f,a1 as g,Z as ee,b as te}from"./_@vue-DEM3y_BF.js";import{D as ae,E as ne}from"./common_options-DMBdfv_8.js";import"./_axios-BtuGy7By.js";import"./_@element-plus-CvluYIrs.js";import"./_@popperjs-DB1lLFnh.js";function se(){const r=U({list:[],total:0,loading:!1,groups:[]}),l=U({page:1,page_size:10,username:""}),o=async()=>{r.loading=!0;const c=await S(l).catch(h=>!1);r.loading=!1,c&&(r.list=c.data.list,r.total=c.data.total)};return{listRes:r,listQuery:l,handlerQuery:()=>{l.page===1?o():l.page=1},getList:o,getGroups:async()=>{const c=await H({page_size:9999}).catch(h=>!1);c&&(r.groups=c.data.list)},toExport:async()=>{const c={...l};c.page_size=1e6,c.page=1;const h=await S(c).catch(y=>!1);if(h){const y=K(h.data.list);W(y,"users.csv")}}}}function oe(){const r=J();return{toAdd:()=>{r.push("/user/add")},toEdit:i=>{r.push("/user/edit/"+i.id)},toTag:i=>{r.push("/user/tag/?user_id="+i.id)},toAddressBook:i=>{r.push("/user/addressBook/?user_id="+i.id)}}}function le(){return{del:async l=>{if(!await A.confirm(t("Confirm?",{param:t("Delete")}),{confirmButtonText:t("Confirm"),cancelButtonText:t("Cancel"),type:"warning"}).catch(b=>!1))return!1;const C=Y({id:l}).catch(b=>!1);return C&&v.success(t("OperationSuccess")),C}}}function re(){return{changePass:async l=>{const o=await A.prompt(t("PleaseInputNewPassword"),t("ResetPassword"),{confirmButtonText:t("Confirm"),cancelButtonText:t("Cancel")}).catch(i=>!1);!o||!await A.confirm(t("Confirm?",{param:t("ResetPassword")}),{confirmButtonText:t("Confirm"),cancelButtonText:t("Cancel")}).catch(i=>!1)||!await F({id:l.id,password:o.value}).catch(i=>!1)||v.success(t("OperationSuccess"))}}}const ce={key:0},ie={key:1},ke={__name:"index",setup(r){const{listRes:l,listQuery:o,handlerQuery:C,getList:b,getGroups:i,toExport:c}=se();z(i),z(b),P(()=>o.page,b),P(()=>o.page_size,C);const{toEdit:h,toAdd:y,toAddressBook:$,toTag:D}=oe(),{changePass:V}=re(),{del:R}=le(),N=async k=>{await R(k.id)&&b(o)},Q=async k=>{const u=k.username,w=btoa(u+`
`),x=`您的用户名为 ${u} 密码为 ${w}`;try{await navigator.clipboard.writeText(x),v.success("已成功复制到剪贴板")}catch(d){v.error("复制失败，请稍后重试"),console.error("Clipboard write failed: ",d)}},j=async k=>{await Z(k).catch(w=>!1)&&(v.success(t("OperationSuccess")),b(o))};return(k,u)=>{const w=m("el-input"),x=m("el-form-item"),d=m("el-button"),G=m("el-form"),B=m("el-card"),p=m("el-table-column"),L=m("el-tag"),O=m("el-switch"),I=m("el-table"),M=m("el-pagination"),q=X("loading");return T(),E("div",null,[a(B,{class:"list-query",shadow:"hover"},{default:n(()=>[a(G,{inline:"","label-width":"80px"},{default:n(()=>[a(x,{label:e(t)("Username")},{default:n(()=>[a(w,{modelValue:e(o).username,"onUpdate:modelValue":u[0]||(u[0]=s=>e(o).username=s)},null,8,["modelValue"])]),_:1},8,["label"]),a(x,null,{default:n(()=>[a(d,{type:"primary",onClick:e(C)},{default:n(()=>[f(g(e(t)("Filter")),1)]),_:1},8,["onClick"]),a(d,{type:"danger",onClick:e(y)},{default:n(()=>[f(g(e(t)("Add")),1)]),_:1},8,["onClick"]),a(d,{type:"success",onClick:e(c)},{default:n(()=>[f(g(e(t)("Export")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(B,{class:"list-body",shadow:"hover"},{default:n(()=>[ee((T(),te(I,{data:e(l).list,border:""},{default:n(()=>[a(p,{prop:"id",label:"ID",align:"center"}),a(p,{prop:"username",label:e(t)("Username"),align:"center"},null,8,["label"]),a(p,{prop:"email",label:e(t)("Email"),align:"center"},null,8,["label"]),a(p,{prop:"nickname",label:e(t)("Nickname"),align:"center"},null,8,["label"]),a(p,{label:e(t)("Group"),align:"center"},{default:n(({row:s})=>[s.group_id?(T(),E("span",ce,[a(L,null,{default:n(()=>[f(g(e(l).groups?.find(_=>_.id===s.group_id)?.name),1)]),_:2},1024)])):(T(),E("span",ie," - "))]),_:1},8,["label"]),a(p,{label:e(t)("Status"),align:"center"},{default:n(({row:s})=>[a(O,{modelValue:s.status,"onUpdate:modelValue":_=>s.status=_,"active-value":e(ne),"inactive-value":e(ae),onChange:_=>j(s)},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value","onChange"])]),_:1},8,["label"]),a(p,{prop:"remark",label:e(t)("Remark"),align:"center"},null,8,["label"]),a(p,{prop:"created_at",label:e(t)("CreatedAt"),align:"center"},null,8,["label"]),a(p,{prop:"updated_at",label:e(t)("UpdatedAt"),align:"center"},null,8,["label"]),a(p,{label:e(t)("Actions"),align:"center",width:"650"},{default:n(({row:s})=>[a(d,{onClick:_=>e(D)(s)},{default:n(()=>[f(g(e(t)("UserTags")),1)]),_:2},1032,["onClick"]),a(d,{onClick:_=>e($)(s)},{default:n(()=>[f(g(e(t)("UserAddressBook")),1)]),_:2},1032,["onClick"]),a(d,{onClick:_=>e(h)(s)},{default:n(()=>[f(g(e(t)("Edit")),1)]),_:2},1032,["onClick"]),a(d,{type:"info",onClick:_=>Q(s)},{default:n(()=>[f(g(e(t)("Copy")),1)]),_:2},1032,["onClick"]),a(d,{type:"warning",onClick:_=>e(V)(s)},{default:n(()=>[f(g(e(t)("ResetPassword")),1)]),_:2},1032,["onClick"]),a(d,{type:"danger",onClick:_=>N(s)},{default:n(()=>[f(g(e(t)("Delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[q,e(l).loading]])]),_:1}),a(B,{class:"list-page",shadow:"hover"},{default:n(()=>[a(M,{background:"",layout:"prev, pager, next, sizes, jumper","page-sizes":[10,20,50,100],"page-size":e(o).page_size,"onUpdate:pageSize":u[1]||(u[1]=s=>e(o).page_size=s),"current-page":e(o).page,"onUpdate:currentPage":u[2]||(u[2]=s=>e(o).page=s),total:e(l).total},null,8,["page-size","current-page","total"])]),_:1})])}}};export{ke as default};
