import{s as h,T as a,p as ne}from"../entry/index-Czm67r7X.js";import{b as H,c as se}from"./_element-plus-T6dmKOyC.js";import{x as O,m as J,r as Q,l as K,aa as re,w as X,an as f,at as ue,c as C,o as c,e as o,Y as t,u as e,a0 as y,a1 as _,Z as de,b as x,a as D,_ as ee,P as S,ah as $,A as ie}from"./_@vue-DEM3y_BF.js";function ce(n){return h({url:"/address_book_collection_rule/list",params:n})}function _e(n){return h({url:"/address_book_collection_rule/create",method:"post",data:n})}function pe(n){return h({url:"/address_book_collection_rule/update",method:"post",data:n})}function fe(n){return h({url:"/address_book_collection_rule/delete",method:"post",data:n})}function me(n){return h({url:"/my/address_book_collection_rule/list",params:n})}function ge(n){return h({url:"/my/address_book_collection_rule/create",method:"post",data:n})}function be(n){return h({url:"/my/address_book_collection_rule/update",method:"post",data:n})}function ve(n){return h({url:"/my/address_book_collection_rule/delete",method:"post",data:n})}const N={admin:{list:ce,remove:fe,update:pe,create:_e},my:{list:me,remove:ve,create:ge,update:be}};function ye(n="my"){const m=O({list:[],total:0,loading:!1}),k=O({page:1,page_size:10,collection_id:null}),p=async()=>{m.loading=!0;const s=await N[n].list(k).catch(u=>!1);m.loading=!1,s&&(m.list=s.data.list,m.total=s.data.total)},T=()=>{k.page===1?p():k.page=1},G=async s=>{if(!await se.confirm(a("Confirm?",{param:a("Delete")}),{confirmButtonText:a("Confirm"),cancelButtonText:a("Cancel"),type:"warning"}).catch(b=>!1))return!1;await N[n].remove({id:s.id}).catch(b=>!1)&&(H.success(a("OperationSuccess")),p())},P=J(s=>[{label:a("Read"),value:1},{label:a("ReadWrite"),value:2},{label:a("FullControl"),value:3}]),g=1,d=2,q=J(s=>[{label:a("Group"),value:d},{label:a("User"),value:g}]),V=Q(!1),i=O({id:0,collection_id:null,type:g,rule:1,g_id:null,u_id:null,to_id:null,user_id:null}),A=s=>{V.value=!0,Object.keys(i).forEach(u=>{i[u]=s[u]}),s.type===g?(i.u_id=s.to_id,i.g_id=E.value.find(u=>u.id===s.to_id)?.group_id):(i.g_id=s.to_id,i.u_id=null)},B=()=>{i.id=0,i.type=g,i.rule=1,i.g_id=null,i.u_id=null,V.value=!0},R=async()=>{const s=i.id?N[n].update:N[n].create,u={...i};u.to_id=u.type===d?u.g_id:u.u_id,await s(u).catch(b=>!1)&&(H.success(a("OperationSuccess")),V.value=!1,p())},w=Q([]),E=Q([]);return{listRes:m,listQuery:k,getList:p,handlerQuery:T,del:G,formVisible:V,formData:i,toEdit:A,toAdd:B,submit:R,rules:P,types:q,groups:w,users:E,getGroupUsers:async()=>{const s=await ne().catch(u=>!1);s&&(w.value=s.data.groups.map(u=>(u.children||(u.children=[]),s.data.users.map(r=>{u.id===r.group_id&&u.children.push(r)}),u)),E.value=s.data.users)},TYPE_G:d,TYPE_U:g,changeGId:()=>{i.u_id=null}}}const ke={key:0},he={key:1},Ce={style:{width:"30%"}},Ve={style:{width:"30%","margin-left":"20px"}},we={__name:"rule",props:{collection:{type:Object,required:!0},is_my:{type:Number,default:0}},setup(n){const m=n,{listRes:k,listQuery:p,getList:T,handlerQuery:G,del:P,formVisible:g,formData:d,toEdit:q,toAdd:V,submit:i,rules:A,types:B,groups:R,users:w,getGroupUsers:E,TYPE_G:j,TYPE_U:Y,changeGId:s}=ye(m.is_my?"my":"admin");return d.collection_id=m.collection.id,d.user_id=m.collection.user_id,p.collection_id=m.collection.id,K(E),K(T),re(T),X(()=>p.page,T),X(()=>p.page_size,G),(u,r)=>{const b=f("el-button"),U=f("el-form-item"),F=f("el-form"),I=f("el-card"),z=f("el-table-column"),le=f("el-table"),te=f("el-pagination"),L=f("el-radio"),M=f("el-radio-group"),W=f("el-option"),Z=f("el-select"),ae=f("el-dialog"),oe=ue("loading");return c(),C("div",null,[o(I,{class:"list-query",shadow:"hover"},{default:t(()=>[o(F,{inline:"","label-width":"80px"},{default:t(()=>[o(U,null,{default:t(()=>[o(b,{type:"primary",onClick:e(G)},{default:t(()=>[y(_(e(a)("Filter")),1)]),_:1},8,["onClick"]),o(b,{type:"danger",onClick:e(V)},{default:t(()=>[y(_(e(a)("Add")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),o(I,{class:"list-body",shadow:"hover"},{default:t(()=>[de((c(),x(le,{data:e(k).list,border:""},{default:t(()=>[o(z,{prop:"rule",label:e(a)("Rule"),align:"center"},{default:t(({row:l})=>[D("div",null,_(e(A).find(v=>v.value===l.rule)?.label),1)]),_:1},8,["label"]),o(z,{prop:"type",label:e(a)("Type"),align:"center"},{default:t(({row:l})=>[D("div",null,_(e(B).find(v=>v.value===l.type)?.label),1)]),_:1},8,["label"]),o(z,{prop:"to_id",label:e(a)("ShareTo"),align:"center"},{default:t(({row:l})=>[l.type===e(Y)?(c(),C("div",ke,_(e(w).find(v=>v.id===l.to_id)?.username),1)):l.type===e(j)?(c(),C("div",he,_(e(R).find(v=>v.id===l.to_id)?.name),1)):ee("",!0)]),_:1},8,["label"]),o(z,{prop:"created_at",label:e(a)("CreatedAt"),align:"center"},null,8,["label"]),o(z,{label:e(a)("Actions"),align:"center","class-name":"table-actions",width:"300",fixed:"right"},{default:t(({row:l})=>[o(b,{onClick:v=>e(q)(l)},{default:t(()=>[y(_(e(a)("Edit")),1)]),_:2},1032,["onClick"]),o(b,{type:"danger",onClick:v=>e(P)(l)},{default:t(()=>[y(_(e(a)("Delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[oe,e(k).loading]])]),_:1}),o(I,{class:"list-page",shadow:"hover"},{default:t(()=>[o(te,{background:"",layout:"prev, pager, next, sizes, jumper","page-sizes":[10,20,50,100],"page-size":e(p).page_size,"onUpdate:pageSize":r[0]||(r[0]=l=>e(p).page_size=l),"current-page":e(p).page,"onUpdate:currentPage":r[1]||(r[1]=l=>e(p).page=l),total:e(k).total},null,8,["page-size","current-page","total"])]),_:1}),o(ae,{modelValue:e(g),"onUpdate:modelValue":r[7]||(r[7]=l=>ie(g)?g.value=l:null),width:"800",title:e(d).id?e(a)("Update"):e(a)("Create"),"close-on-click-modal":!1},{default:t(()=>[o(F,{class:"dialog-form",ref:"form",model:e(d),"label-width":"120px"},{default:t(()=>[o(U,{label:e(a)("AddressBookName")},{default:t(()=>[y(_(m.collection.name),1)]),_:1},8,["label"]),o(U,{label:e(a)("Rule"),prop:"rule",required:""},{default:t(()=>[o(M,{modelValue:e(d).rule,"onUpdate:modelValue":r[2]||(r[2]=l=>e(d).rule=l)},{default:t(()=>[(c(!0),C(S,null,$(e(A),l=>(c(),x(L,{key:l.value,value:l.value},{default:t(()=>[y(_(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(U,{label:e(a)("Type"),prop:"type",required:""},{default:t(()=>[o(M,{modelValue:e(d).type,"onUpdate:modelValue":r[3]||(r[3]=l=>e(d).type=l)},{default:t(()=>[(c(!0),C(S,null,$(e(B),l=>(c(),x(L,{key:l.value,value:parseInt(l.value)},{default:t(()=>[y(_(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(U,{label:e(a)("ShareTo"),prop:"g_id",required:""},{default:t(()=>[D("div",Ce,[o(Z,{modelValue:e(d).g_id,"onUpdate:modelValue":r[4]||(r[4]=l=>e(d).g_id=l),onChange:e(s)},{default:t(()=>[(c(!0),C(S,null,$(e(R),l=>(c(),x(W,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),D("div",Ve,[e(d).type===e(Y)?(c(),x(Z,{key:0,modelValue:e(d).u_id,"onUpdate:modelValue":r[5]||(r[5]=l=>e(d).u_id=l)},{default:t(()=>[(c(!0),C(S,null,$(e(w).filter(l=>l.group_id===e(d).g_id),l=>(c(),x(W,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):ee("",!0)])]),_:1},8,["label"]),o(U,null,{default:t(()=>[o(b,{onClick:r[6]||(r[6]=l=>g.value=!1)},{default:t(()=>[y(_(e(a)("Cancel")),1)]),_:1}),o(b,{onClick:e(i),type:"primary"},{default:t(()=>[y(_(e(a)("Submit")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{we as _};
