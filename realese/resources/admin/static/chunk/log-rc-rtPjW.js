import{l as _}from"./peer-DzPg3Mq6.js";import{l as w}from"./peer-D9oS7b6H.js";import{s as n,T as a}from"../entry/index-Czm67r7X.js";import{j as b,d as v}from"./file-Dmzv2BFm.js";import{b as d,c as m}from"./_element-plus-T6dmKOyC.js";import{x as g}from"./_@vue-DEM3y_BF.js";function h(t){return n({url:"/login_log/list",params:t})}function y(t){return n({url:"/login_log/delete",method:"post",data:t})}function D(t){return n({url:"/login_log/batchDelete",method:"post",data:t})}function x(t){return n({url:"/my/login_log/list",params:t})}function B(t){return n({url:"/my/login_log/delete",method:"post",data:t})}function C(t){return n({url:"/my/login_log/batchDelete",method:"post",data:t})}const f={admin:{batchDelete:D,list:h,remove:y,fetchPeers:_},my:{batchDelete:C,list:x,remove:B,fetchPeers:w}};function M(t="my"){const l=g({list:[],total:0,loading:!1}),c=g({page:1,page_size:10,is_my:0,user_id:null}),u=async()=>{l.loading=!0;const e=await f[t].list(c).catch(o=>!1);if(l.loading=!1,e){const o=e.data.list.filter(s=>s.uuid&&s.client==="client"&&!s.device_id).map(s=>s.uuid);if(o.length>0){const s=[...new Set(o)],r=await f[t].fetchPeers({uuids:s}).catch(i=>!1);r?.data?.list&&e.data.list.forEach(i=>{i.uuid&&(i.peer=r.data.list.find(p=>p.uuid===i.uuid))})}l.list=e.data.list,l.total=e.data.total}};return{listRes:l,listQuery:c,getList:u,handlerQuery:()=>{c.page===1?u():c.page=1},del:async e=>{if(!await m.confirm(a("Confirm?",{param:a("Delete")}),{confirmButtonText:a("Confirm"),cancelButtonText:a("Cancel"),type:"warning"}).catch(r=>!1))return!1;await f[t].remove({id:e.id}).catch(r=>!1)&&(d.success(a("OperationSuccess")),u())},batchdel:async e=>{const o=e.map(i=>i.id);if(!o.length)return d.warning(a("PleaseSelectData")),!1;if(!await m.confirm(a("Confirm?",{param:a("BatchDelete")}),{confirmButtonText:a("Confirm"),cancelButtonText:a("Cancel"),type:"warning"}).catch(i=>!1))return!1;await f[t].batchDelete({ids:o}).catch(i=>!1)&&(d.success(a("OperationSuccess")),u())},toExport:async()=>{if(t!=="admin")return!1;const e={...c};e.page_size=1e6,e.page=1;const o=await h(e).catch(s=>!1);if(o){const s=b(o.data.list);v(s,"loginLog.csv")}}}}export{M as u};
